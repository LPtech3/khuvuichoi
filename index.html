<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá th·ªëng Checklist C√¥ng Vi√™n (Real-time Demo)</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f1f5f9;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --text: #1e293b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: var(--bg); min-height: 100vh; color: var(--text); }

        /* --- LOGIN --- */
        .login-wrap {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            display: flex; justify-content: center; align-items: center; z-index: 1000;
        }
        .login-box {
            background: white; padding: 2rem; border-radius: 1rem; width: 90%; max-width: 400px;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
        }
        .form-group { margin-bottom: 1rem; }
        .form-input {
            width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 0.5rem;
            margin-top: 0.5rem;
        }
        .btn {
            width: 100%; padding: 0.75rem; border: none; border-radius: 0.5rem;
            font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #1d4ed8; }
        
        /* --- DASHBOARD --- */
        .dashboard { display: none; padding: 20px; max-width: 800px; margin: 0 auto; }
        .header {
            background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .badge {
            padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold;
        }
        .badge-admin { background: #dbeafe; color: #1e40af; }
        .badge-staff { background: #f3f4f6; color: #1f2937; }

        /* --- CHECKLIST --- */
        .card { background: white; border-radius: 10px; overflow: hidden; margin-bottom: 15px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .card-head {
            padding: 15px; background: #f8fafc; border-bottom: 1px solid #e2e8f0;
            display: flex; justify-content: space-between; align-items: center;
        }
        .task-item {
            padding: 15px; border-bottom: 1px solid #f1f5f9;
            display: flex; flex-direction: column; gap: 8px;
        }
        .task-row { display: flex; gap: 10px; align-items: flex-start; }
        .task-check { width: 20px; height: 20px; margin-top: 2px; cursor: pointer; }
        .task-time { font-weight: bold; color: var(--primary); font-size: 0.9rem; display: block; }
        .task-input {
            width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 5px; font-size: 0.9rem;
        }

        /* --- MANAGER VIEW --- */
        .monitor-grid { display: grid; gap: 15px; }
        .monitor-card { background: white; padding: 15px; border-radius: 10px; border-left: 5px solid #ccc; }
        .monitor-card.done { border-left-color: var(--success); }
        .monitor-card.pending { border-left-color: var(--warning); }
        
        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .bg-green { background: var(--success); }
        .bg-gray { background: #cbd5e1; }

        /* --- SUBMIT BUTTON --- */
        .submit-area { margin-top: 20px; padding: 20px; background: white; border-radius: 10px; text-align: center; }
        .btn-submit { 
            background: var(--success); color: white; padding: 12px 24px; font-size: 1rem; 
            display: flex; align-items: center; justify-content: center; gap: 8px; margin: 0 auto;
        }
        .btn-submit:disabled { background: #9ca3af; cursor: not-allowed; }
        .submitted-alert {
            background: #dcfce7; color: #166534; padding: 10px; border-radius: 5px; margin-top: 10px; display: none;
        }

    </style>
</head>
<body>

    <div id="loginScreen" class="login-wrap">
        <div class="login-box">
            <h2 style="text-align: center; margin-bottom: 20px;">üîê H·ªá th·ªëng C√¥ng Vi√™n</h2>
            <div class="form-group">
                <label>T√™n ƒëƒÉng nh·∫≠p</label>
                <input type="text" id="uName" class="form-input" placeholder="admin, nam_np, nu_xd...">
            </div>
            <div class="form-group">
                <label>M·∫≠t kh·∫©u</label>
                <input type="password" id="pWord" class="form-input" value="123">
            </div>
            <button class="btn btn-primary" onclick="login()">ƒêƒÉng Nh·∫≠p</button>
            <p style="margin-top: 15px; font-size: 0.8rem; color: #666; text-align: center;">
                M·∫∑c ƒë·ªãnh: admin, nam_np, nu_np, nam_xd, nu_xd (Pass: 123)
            </p>
        </div>
    </div>

    <div id="dashboard" class="dashboard">
        <div class="header">
            <div>
                <h3 id="uiName">Xin ch√†o</h3>
                <span id="uiRole" class="badge badge-staff">Staff</span>
            </div>
            <button onclick="logout()" style="padding: 5px 10px; border: 1px solid #ddd; background: white; border-radius: 5px; cursor: pointer;">ƒêƒÉng xu·∫•t</button>
        </div>

        <div style="background: white; padding: 10px; margin-bottom: 15px; border-radius: 10px; display: flex; align-items: center; gap: 10px;">
            <label>üìÖ Ng√†y l√†m vi·ªác:</label>
            <input type="date" id="datePicker" style="padding: 5px; border-radius: 5px; border: 1px solid #ccc;" onchange="changeDate()">
        </div>

        <div id="contentArea"></div>
    </div>

    <script>
        // D·ªÆ LI·ªÜU C·∫§U H√åNH
        const TASKS = {
            nam_np: {
                title: "üë® Nam Nh√† Phao",
                items: [
                    { t: "15:30", d: "C√≥ m·∫∑t, check in, d·ªçn xe ra ƒëi·ªÉm t·∫≠p trung" },
                    { t: "16:00", d: "G·ª° b·∫°t nh√† phao, d√°n 3 ·ªëng, n·ªëi m√°y b∆°m" },
                    { t: "16:00", d: "D·ªçn h·ªì c√°, b∆°m n∆∞·ªõc, th·∫£ c√° (lau kh√¥ gh·∫ø)" },
                    { t: "Khi ƒë·∫ßy", d: "Lau d·ªçn nh√† h∆°i (lau ∆∞·ªõt -> th·ªïi kh√¥)" },
                    { t: "17:30", d: "Treo ƒë√®n nh√† phao v√† h·ªì c√°" },
                    { t: "18:30", d: "Nh·∫∑t r√°c s·∫°ch s·∫Ω xung quanh" },
                    { t: "20:00", d: "X·∫£ nh√† phao, g·∫•p l·∫°i, k√©o b·∫°t che" },
                    { t: "20:30", d: "D·ªçn h·ªì c√°, c·∫•t ƒë·ªì, k√©o b·∫°t" },
                    { t: "Cu·ªëi ca", d: "Ch·ª•p h√¨nh s·ªë n∆∞·ªõc b√°o Group", input: true },
                    { t: "Cu·ªëi ca", d: "R√∫t ƒëi·ªán, t·∫Øt ƒë√®n c√¥ng vi√™n" },
                    { t: "Cu·ªëi ca", d: "Ph·ª• khu xe ƒëi·ªán k√©o xe v·ªÅ" },
                    { t: "21:00", d: "Check out (Ch·ª•p ƒë·ªìng h·ªì n∆∞·ªõc)", input: true }
                ]
            },
            nu_np: {
                title: "üë© N·ªØ Nh√† Phao",
                items: [
                    { t: "15:30", d: "Check in, ph·ª• d·ªçn xe ra ƒëi·ªÉm t·∫≠p trung" },
                    { t: "ƒê·∫ßu ca", d: "Nh·∫∑t r√°c, ki·ªÉm k√™ n∆∞·ªõc ƒë·∫ßu ca", input: true },
                    { t: "18:00", d: "ƒê·ªët nhang mu·ªói" },
                    { t: "18:30", d: "ƒêi nh·∫∑t r√°c, gi·ªØ th√πng ti·ªÅn" },
                    { t: "20:00", d: "Ph·ª• d·ªçn nh√† phao, h·ªì c√°, k√©o b·∫°t" },
                    { t: "Cu·ªëi ca", d: "Ki·ªÉm k√™ n∆∞·ªõc cu·ªëi ca", input: true },
                    { t: "Cu·ªëi ca", d: "S·∫°c ƒë√®n, b·ªô ƒë√†m" },
                    { t: "21:00", d: "Check out" }
                ]
            },
            nam_xd: {
                title: "üë® Nam Xe ƒêi·ªán",
                items: [
                    { t: "15:30", d: "Check in, d·ªçn xe ra (tr∆∞·ªõc 16:30)" },
                    { t: "Chi·ªÅu", d: "ƒê·ªÉ c·ªçc ph√¢n lu·ªìng, giƒÉng d√¢y, b·∫≠t nh·∫°c" },
                    { t: "T·ªëi", d: "B·∫≠t ƒë√®n khu trung t√¢m" },
                    { t: "18:00", d: "ƒê·ªët nhang mu·ªói" },
                    { t: "18:30", d: "Nh·∫∑t r√°c xung quanh" },
                    { t: "20:00", d: "D·ªçn xe v·ªÅ kho, d·ªçn b·∫°t" },
                    { t: "Cu·ªëi ca", d: "S·∫°c Pin xe, ƒë√®n, loa, b·ªô ƒë√†m" },
                    { t: "21:00", d: "Check out, tr√πm xe c·∫•t kho" }
                ]
            },
            nu_xd: {
                title: "üë© N·ªØ Xe ƒêi·ªán",
                items: [
                    { t: "16:00", d: "Check in, ph·ª• d·ªçn xe, lau xe" },
                    { t: "ƒê·∫ßu ca", d: "Ki·ªÉm ti·ªÅn l·∫ª, m√°y in, b·ªô ƒë√†m" },
                    { t: "ƒê·∫ßu ca", d: "B√°o s·ªë v√≤ng tay + N∆∞·ªõc", input: true },
                    { t: "18:00", d: "ƒê·ªët nhang mu·ªói" },
                    { t: "18:30", d: "Nh·∫∑t r√°c, gi·ªØ th√πng ti·ªÅn" },
                    { t: "20:00", d: "D·ªçn xe v·ªÅ kho" },
                    { t: "Cu·ªëi ca", d: "B√°o s·ªë v√≤ng tay + N∆∞·ªõc cu·ªëi ca", input: true },
                    { t: "Cu·ªëi ca", d: "S·∫°c pin c√°c thi·∫øt b·ªã" },
                    { t: "21:00", d: "Check out" }
                ]
            }
        };

        const USERS = {
            admin: { name: "Qu·∫£n Tr·ªã Vi√™n", role: "admin" },
            nam_np: { name: "Nh√¢n vi√™n Nam (Nh√† Phao)", role: "nam_np" },
            nu_np: { name: "Nh√¢n vi√™n N·ªØ (Nh√† Phao)", role: "nu_np" },
            nam_xd: { name: "Nh√¢n vi√™n Nam (Xe ƒêi·ªán)", role: "nam_xd" },
            nu_xd: { name: "Nh√¢n vi√™n N·ªØ (Xe ƒêi·ªán)", role: "nu_xd" }
        };

        let currentUser = null;
        let currentDate = new Date().toISOString().split('T')[0];

        // --- H√ÄM H·ªÜ TH·ªêNG ---
        function init() {
            document.getElementById('datePicker').value = currentDate;
            
            // L·∫Øng nghe s·ª± ki·ªán thay ƒë·ªïi localStorage (Real-time gi·ªØa c√°c tab)
            window.addEventListener('storage', () => {
                if (currentUser) changeDate(); // T·ª± ƒë·ªông t·∫£i l·∫°i khi c√≥ d·ªØ li·ªáu m·ªõi
            });
        }

        function login() {
            const u = document.getElementById('uName').value;
            const p = document.getElementById('pWord').value;
            if (USERS[u] && p === '123') {
                currentUser = USERS[u];
                currentUser.username = u;
                
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                
                document.getElementById('uiName').innerText = currentUser.name;
                document.getElementById('uiRole').innerText = currentUser.role === 'admin' ? 'Admin' : 'Nh√¢n vi√™n';
                document.getElementById('uiRole').className = currentUser.role === 'admin' ? 'badge badge-admin' : 'badge badge-staff';
                
                changeDate();
            } else {
                alert("Sai t√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u!");
            }
        }

        function logout() {
            location.reload();
        }

        function changeDate() {
            currentDate = document.getElementById('datePicker').value;
            const area = document.getElementById('contentArea');
            area.innerHTML = '';

            if (currentUser.role === 'admin') {
                renderAdminView(area);
                // Auto refresh cho Admin m·ªói 5 gi√¢y ƒë·ªÉ gi·∫£ l·∫≠p real-time
                if(!window.adminInterval) {
                    window.adminInterval = setInterval(changeDate, 5000);
                }
            } else {
                if(window.adminInterval) clearInterval(window.adminInterval);
                renderStaffView(area);
            }
        }

        // --- X·ª¨ L√ù D·ªÆ LI·ªÜU ---
        function getData(role) {
            const key = `cl_${currentDate}_${role}`;
            return JSON.parse(localStorage.getItem(key)) || { tasks: {}, submitted: false, submitTime: null };
        }

        function saveData(role, data) {
            const key = `cl_${currentDate}_${role}`;
            localStorage.setItem(key, JSON.stringify(data));
            // K√≠ch ho·∫°t s·ª± ki·ªán storage cho c√°c tab kh√°c
            window.dispatchEvent(new Event('storage'));
        }

        // --- GIAO DI·ªÜN NH√ÇN VI√äN ---
        function renderStaffView(container) {
            const role = currentUser.role;
            const config = TASKS[role];
            const data = getData(role);
            const isSubmitted = data.submitted;

            let html = `
                <div class="card">
                    <div class="card-head">
                        <strong>üìã Checklist: ${config.title}</strong>
                        ${isSubmitted ? '<span style="color:green">‚úÖ ƒê√£ g·ª≠i b√°o c√°o</span>' : '<span style="color:#666">‚è≥ ƒêang l√†m vi·ªác</span>'}
                    </div>
                    <div id="taskList">
            `;

            config.items.forEach((item, idx) => {
                const checked = data.tasks[idx]?.done ? 'checked' : '';
                const val = data.tasks[idx]?.val || '';
                const disabled = isSubmitted ? 'disabled' : ''; // Kh√≥a n·∫øu ƒë√£ n·ªôp

                html += `
                    <div class="task-item">
                        <div class="task-row">
                            <input type="checkbox" class="task-check" ${checked} ${disabled}
                                onchange="updateTask(${idx}, 'done', this.checked)">
                            <div>
                                <span class="task-time">${item.t}</span>
                                <span>${item.d}</span>
                            </div>
                        </div>
                        ${item.input ? `
                            <input type="text" class="task-input" placeholder="Nh·∫≠p s·ªë li·ªáu..." value="${val}" ${disabled}
                                oninput="updateTask(${idx}, 'val', this.value)">
                        ` : ''}
                    </div>
                `;
            });

            html += `</div></div>`;

            // Ph·∫ßn n√∫t g·ª≠i
            html += `
                <div class="submit-area">
                    ${isSubmitted 
                        ? `<div class="submitted-alert" style="display:block">üéâ B·∫°n ƒë√£ g·ª≠i b√°o c√°o l√∫c <strong>${data.submitTime}</strong>. Admin ƒë√£ nh·∫≠n ƒë∆∞·ª£c.</div>`
                        : `<button class="btn btn-submit" onclick="submitReport()">üöÄ G·ª≠i b√°o c√°o cho Qu·∫£n L√Ω</button>`
                    }
                </div>
            `;

            container.innerHTML = html;
        }

        function updateTask(idx, field, value) {
            const data = getData(currentUser.role);
            if (data.submitted) return; // Ch·∫∑n s·ª≠a n·∫øu ƒë√£ n·ªôp
            
            if (!data.tasks[idx]) data.tasks[idx] = {};
            data.tasks[idx][field] = value;
            saveData(currentUser.role, data);
        }

        function submitReport() {
            if(!confirm("X√°c nh·∫≠n g·ª≠i b√°o c√°o? Sau khi g·ª≠i b·∫°n s·∫Ω kh√¥ng th·ªÉ ch·ªânh s·ª≠a.")) return;
            
            const data = getData(currentUser.role);
            data.submitted = true;
            data.submitTime = new Date().toLocaleTimeString('vi-VN');
            saveData(currentUser.role, data);
            
            changeDate(); // Render l·∫°i giao di·ªán
        }

        // --- GIAO DI·ªÜN ADMIN ---
        function renderAdminView(container) {
            const roles = ['nam_np', 'nu_np', 'nam_xd', 'nu_xd'];
            let html = '<div class="monitor-grid">';

            roles.forEach(role => {
                const data = getData(role);
                const config = TASKS[role];
                
                // T√≠nh to√°n ti·∫øn ƒë·ªô
                const total = config.items.length;
                const done = Object.values(data.tasks).filter(t => t.done).length;
                const percent = Math.round((done / total) * 100);
                
                // Tr·∫°ng th√°i
                const statusClass = data.submitted ? 'done' : 'pending';
                const statusText = data.submitted 
                    ? `<span style="color:var(--success)">‚úÖ ƒê√£ n·ªôp l√∫c ${data.submitTime}</span>` 
                    : `<span style="color:var(--warning)">‚è≥ ƒêang l√†m... (${done}/${total})</span>`;

                html += `
                    <div class="monitor-card ${statusClass}">
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <strong>${config.title}</strong>
                            ${statusText}
                        </div>
                        
                        <div style="height:6px; background:#e2e8f0; border-radius:3px; margin-bottom:10px;">
                            <div style="height:100%; background:${data.submitted ? 'var(--success)' : 'var(--primary)'}; width:${percent}%"></div>
                        </div>

                        <div style="font-size:0.9rem; color:#475569; max-height: 150px; overflow-y:auto;">
                            ${config.items.map((item, idx) => {
                                const task = data.tasks[idx] || {};
                                if (!task.done && !task.val) return ''; // ·∫®n c√°i ch∆∞a l√†m ƒë·ªÉ g·ªçn
                                return `
                                    <div style="margin-bottom:4px;">
                                        <span class="status-dot bg-green"></span>
                                        ${item.t}: ${task.val ? `<b>${task.val}</b>` : 'Ho√†n th√†nh'}
                                    </div>
                                `;
                            }).join('')}
                            ${(done === 0) ? '<i>Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o</i>' : ''}
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            html += '<div style="text-align:center; margin-top:20px; color:#666; font-size:0.8rem;">D·ªØ li·ªáu t·ª± ƒë·ªông c·∫≠p nh·∫≠t m·ªói 5 gi√¢y...</div>';
            container.innerHTML = html;
        }

        // Ch·∫°y kh·ªüi t·∫°o
        init();
    </script>
</body>
</html>
